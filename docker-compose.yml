version: '3.7'
services:
  mongodb:
    #image: mongo
    restart: always
    ports:
      - "27017:27017"
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin
      MONGO_INITDB_DATABASE: admin
    volumes:
      #- /data:/data
      - ./mongo-db/mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js
    networks:
      - webnet

  auth-service:
    container_name: "auth-service"
    environment:
      #- MONGO_HOST=mongodb
      - MONGO_HOST=10.1.3.189
      - MONGO_PORT=27017
      - MONGO_USER=root
      - MONGO_PASS=miworld
    restart: always
    logging:
      options:
        max-size: "10m"
        max-file: "10"
    #image: ${DOCKER_REGISTRY}/auth-service
    #build: auth-service
    ports:
      - "8080:8080"
    networks:
      - webnet
    depends_on:
      - mongodb

  lesson-plans:
    container_name: "lesson-plans"
    environment:
      #- MONGO_HOST=mongodb
      - MONGO_HOST=10.1.3.189
      - MONGO_PORT=27017
      - MONGO_USER=root
      - MONGO_PASS=miworld
      - AUTH_SERVICE_URI=http://auth-service:8080
    restart: always
    logging:
      options:
        max-size: "10m"
        max-file: "10"
    #image: ${DOCKER_REGISTRY}/lesson-plans
    #build: lesson-plans
    networks:
      - webnet
    ports:
      - "8090:8090"
    depends_on:
      - mongodb

  survey:
    container_name: "assessment"
    environment:
      #- MONGO_HOST=mongodb
      - MONGO_HOST=10.1.3.189
      - MONGO_PORT=27017
      - MONGO_USER=root
      - MONGO_PASS=miworld
      - AUTH_SERVICE_URI=http://auth-service:8080
    restart: always
    logging:
      options:
        max-size: "10m"
        max-file: "10"
    #image: ${DOCKER_REGISTRY}/survey
    #build: survey
    networks:
      - webnet
    ports:
      - "8092:8092"
    depends_on:
      - mongodb

  api-gateway:
    container_name: "api-gateway"
    environment:
      - lessonplanUri=http://lesson-plans:8090/lessonplans
      - assessmentUri=http://auth-service:8080/assessments
      - authUri=http://auth-service:8080/auth
    restart: always
    logging:
      options:
        max-size: "10m"
        max-file: "10"
    #image: ${DOCKER_REGISTRY}/survey
    #build: survey
    networks:
      - webnet
    ports:
      - "8092:8092"
    depends_on:
      - mongodb

networks:
  webnet:
    driver: bridge